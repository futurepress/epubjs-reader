EPUBJS.reader.SidebarController = function (book) {
    var reader = this;

    var $sidebar = $("#sidebar"),
        $panels = $("#panels");

    var activePanel = "Toc";

    var changePanelTo = function (viewName) {
        var controllerName = viewName + "Controller";

        if (activePanel == viewName || typeof reader[controllerName] === 'undefined')
            return;
        reader[activePanel + "Controller"].hide();
        reader[controllerName].show();
        activePanel = viewName;

        $panels.find('.active').removeClass("active");
        $panels.find("#show-" + viewName).addClass("active");
    };

    var getActivePanel = function () {
        return activePanel;
    };

    var show = function () {
        reader.sidebarOpen = true;
        reader.ReaderController.slideOut();
        $sidebar.addClass("open");
    }

    var hide = function () {
        reader.sidebarOpen = false;
        reader.ReaderController.slideIn();
        $sidebar.removeClass("open");
    }

    $panels.find(".show_view").on("click", function (event) {
        var view = $(this).data("view");

        changePanelTo(view);
        event.preventDefault();
    });

    return {
        'show': show,
        'hide': hide,
        'getActivePanel': getActivePanel,
        'changePanelTo': changePanelTo
    };
};