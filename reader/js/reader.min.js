var EPUBJS=EPUBJS||{};EPUBJS.core={};var ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8,DOCUMENT_NODE=9;EPUBJS.core.getEl=function(e){return document.getElementById(e)},EPUBJS.core.getEls=function(e){return document.getElementsByClassName(e)},EPUBJS.core.request=function(e,t,n){var o=window.URL,r=o?"blob":"arraybuffer",i=new RSVP.defer,s=new XMLHttpRequest,a=XMLHttpRequest.prototype;return"overrideMimeType"in a||Object.defineProperty(a,"overrideMimeType",{value:function(e){}}),s.onreadystatechange=function(){var e;this.readyState==this.DONE&&(200!==this.status&&0!==this.status||!this.response?i.reject({message:this.response,stack:(new Error).stack}):(e="xml"==t?this.responseXML||(new DOMParser).parseFromString(this.response,"application/xml"):"xhtml"==t?this.responseXML||(new DOMParser).parseFromString(this.response,"application/xhtml+xml"):"html"==t?this.responseXML||(new DOMParser).parseFromString(this.response,"text/html"):"json"==t?JSON.parse(this.response):"blob"!=t||o?this.response:new Blob([this.response]),i.resolve(e)))},s.open("GET",e,!0),n&&(s.withCredentials=!0),t||(e=EPUBJS.core.uri(e),t={htm:"html"}[t=e.extension]||t),"blob"==t&&(s.responseType=r),"json"==t&&s.setRequestHeader("Accept","application/json"),"xml"==t&&(s.responseType="document",s.overrideMimeType("text/xml")),"xhtml"==t&&(s.responseType="document"),"html"==t&&(s.responseType="document"),"binary"==t&&(s.responseType="arraybuffer"),s.send(),i.promise},EPUBJS.core.toArray=function(e){var t,n,o=[];for(t in e)e.hasOwnProperty(t)&&((n=e[t]).ident=t,o.push(n));return o},EPUBJS.core.uri=function(e){var t={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:e},n=e.indexOf("blob:"),o=e.indexOf("://"),r=e.indexOf("?"),i=e.indexOf("#");return 0===n?(t.protocol="blob",t.base=e.indexOf(0,i)):(-1!=i&&(t.fragment=e.slice(i+1),e=e.slice(0,i)),-1!=r&&(t.search=e.slice(r+1),e=e.slice(0,r),href=t.href),-1!=o?(t.protocol=e.slice(0,o),-1===(o=(r=e.slice(o+3)).indexOf("/"))?(t.host=t.path,t.path=""):(t.host=r.slice(0,o),t.path=r.slice(o)),t.origin=t.protocol+"://"+t.host,t.directory=EPUBJS.core.folder(t.path),t.base=t.origin+t.directory):(t.path=e,t.directory=EPUBJS.core.folder(e),t.base=t.directory),t.filename=e.replace(t.base,""),-1!=(e=t.filename.lastIndexOf("."))&&(t.extension=t.filename.slice(e+1))),t},EPUBJS.core.folder=function(e){var t=e.lastIndexOf("/");return-1==t&&0,e.slice(0,t+1)},EPUBJS.core.dataURLToBlob=function(e){var t,n,o,r,i,s=";base64,";if(-1==e.indexOf(s))return n=(t=e.split(","))[0].split(":")[1],o=t[1],new Blob([o],{type:n});n=(t=e.split(s))[0].split(":")[1],r=(o=window.atob(t[1])).length,i=new Uint8Array(r);for(var a=0;a<r;++a)i[a]=o.charCodeAt(a);return new Blob([i],{type:n})},EPUBJS.core.addScript=function(e,t,n){var o=!1,r=document.createElement("script");r.type="text/javascript",r.async=!1,r.src=e,r.onload=r.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,t&&t())},(n=n||document.body).appendChild(r)},EPUBJS.core.addScripts=function(e,t,n){var o=e.length,r=0,i=function(){o==++r?t&&t():EPUBJS.core.addScript(e[r],i,n)};EPUBJS.core.addScript(e[r],i,n)},EPUBJS.core.addCss=function(e,t,n){var o=!1,r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,r.onload=r.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,t&&t())},(n=n||document.body).appendChild(r)},EPUBJS.core.prefixed=function(e){var t=["Webkit","Moz","O","ms"],n=e[0].toUpperCase()+e.slice(1),o=t.length;if(void 0!==document.documentElement.style[e])return e;for(var r=0;r<o;r++)if(void 0!==document.documentElement.style[t[r]+n])return t[r]+n;return e},EPUBJS.core.resolveUrl=function(e,t){var n=[],o=EPUBJS.core.uri(t),r=e.split("/");return o.host?t:(r.pop(),t.split("/").forEach(function(e){".."===e?r.pop():n.push(e)}),r.concat(n).join("/"))},EPUBJS.core.uuid=function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:7&t|8).toString(16)})},EPUBJS.core.insert=function(e,t,n){n=EPUBJS.core.locationOf(e,t,n);return t.splice(n,0,e),n},EPUBJS.core.locationOf=function(e,t,n,o,r){var i=o||0,s=r||t.length,o=parseInt(i+(s-i)/2);return s-i<=0?o:(r=(n=n||function(e,t){return t<e?1:e<t?-1:(e=t)?0:void 0})(t[o],e),s-i==1?0<r?o:o+1:0===r?o:-1===r?EPUBJS.core.locationOf(e,t,n,o,s):EPUBJS.core.locationOf(e,t,n,i,o))},EPUBJS.core.indexOfSorted=function(e,t,n,o,r){var i=o||0,s=r||t.length,o=parseInt(i+(s-i)/2);return s-i<=0?-1:(r=(n=n||function(e,t){return t<e?1:e<t?-1:(e=t)?0:void 0})(t[o],e),s-i==1?0===r?o:-1:0===r?o:-1===r?EPUBJS.core.indexOfSorted(e,t,n,o,s):EPUBJS.core.indexOfSorted(e,t,n,i,o))},EPUBJS.core.queue=function(e){function t(){var e;o.length&&(e=o.shift(),n[e.funcName].apply(e.context||n,e.args))}var o=[],n=e;return{enqueue:function(e,t,n){return o.push({funcName:e,args:t,context:n}),o},dequeue:t,flush:function(){for(;o.length;)t()},clear:function(){o=[]},length:function(){return o.length}}},EPUBJS.core.getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':EPUBJS.core.getElementTreeXPath(e)},EPUBJS.core.getElementTreeXPath=function(e){var t,n,o,r=[],i="http://www.w3.org/1999/xhtml"===e.ownerDocument.documentElement.getAttribute("xmlns");for(e.nodeType===Node.TEXT_NODE&&(t=EPUBJS.core.indexOfTextNode(e)+1,r.push("text()["+t+"]"),e=e.parentNode);e&&1==e.nodeType;e=e.parentNode){t=0;for(var s=e.previousSibling;s;s=s.previousSibling)s.nodeType!=Node.DOCUMENT_TYPE_NODE&&s.nodeName==e.nodeName&&++t;o=e.nodeName.toLowerCase(),n=i?"xhtml:"+o:o,o=t?"["+(t+1)+"]":"",r.splice(0,0,n+o)}return r.length?"./"+r.join("/"):null},EPUBJS.core.nsResolver=function(e){return{xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"}[e]||null},EPUBJS.core.cleanStringForXpath=function(e){return"concat('',"+e.match(/[^'"]+|['"]/g).map(function(e){return"'"===e?'"\'"':'"'===e?"'\"'":"'"+e+"'"}).join(",")+")"},EPUBJS.core.indexOfTextNode=function(e){for(var t,n=e.parentNode.childNodes,o=-1,r=0;r<n.length&&((t=n[r]).nodeType===Node.TEXT_NODE&&o++,t!=e);r++);return o},EPUBJS.core.defaults=function(e){for(var t=1,n=arguments.length;t<n;t++){var o,r=arguments[t];for(o in r)void 0===e[o]&&(e[o]=r[o])}return e},EPUBJS.core.extend=function(n){return[].slice.call(arguments,1).forEach(function(t){t&&Object.getOwnPropertyNames(t).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}),n},EPUBJS.core.clone=function(e){return EPUBJS.core.isArray(e)?e.slice():EPUBJS.core.extend({},e)},EPUBJS.core.isElement=function(e){return!(!e||1!=e.nodeType)},EPUBJS.core.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},EPUBJS.core.isString=function(e){return"string"==typeof e||e instanceof String},EPUBJS.core.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},EPUBJS.core.values=function(e){var t,n,o,r=-1;if(!e)return[];for(n=(t=Object.keys(e)).length,o=Array(n);++r<n;)o[r]=e[t[r]];return o},EPUBJS.core.indexOfNode=function(e,t){for(var n,o=e.parentNode.childNodes,r=-1,i=0;i<o.length&&((n=o[i]).nodeType===t&&r++,n!=e);i++);return r},EPUBJS.core.indexOfTextNode=function(e){return EPUBJS.core.indexOfNode(e,TEXT_NODE)},EPUBJS.core.indexOfElementNode=function(e){return EPUBJS.core.indexOfNode(e,ELEMENT_NODE)},(EPUBJS=EPUBJS||{}).reader={},EPUBJS.reader.plugins={},function(e){e.ePubReader,e=e.ePubReader=function(e,t){return new EPUBJS.Reader(e,t)},"function"==typeof define&&define.amd?define(function(){return Reader}):"undefined"!=typeof module&&module.exports&&(module.exports=e)}(window,jQuery),EPUBJS.Reader=function(e,t){var n,o,r=this,i=$("#viewer").empty(),s=window.location.search;for(o in this.settings=EPUBJS.core.defaults(t||{},{bookPath:e,restore:!1,reload:!1,bookmarks:void 0,annotations:void 0,contained:void 0,bookKey:void 0,styles:void 0,sidebarReflow:!1,generatePagination:!1,history:!0}),s&&s.slice(1).split("&").forEach(function(e){var t=e.split("="),e=t[0],t=t[1]||"";r.settings[e]=decodeURIComponent(t)}),this.setBookKey(this.settings.bookPath),this.settings.restore&&this.isSaved()&&this.applySavedSettings(),this.settings.styles=this.settings.styles||{fontSize:"100%"},this.book=n=new ePub(this.settings.bookPath,this.settings),this.offline=!1,this.sidebarOpen=!1,this.settings.bookmarks||(this.settings.bookmarks=[]),this.settings.annotations||(this.settings.annotations=[]),this.settings.generatePagination&&n.generatePagination(i.width(),i.height()),this.rendition=n.renderTo("viewer",{ignoreClass:"annotator-hl",width:"100%",height:"100%"}),this.settings.previousLocationCfi?this.displayed=this.rendition.display(this.settings.previousLocationCfi):this.displayed=this.rendition.display(),n.ready.then(function(){r.ReaderController=EPUBJS.reader.ReaderController.call(r,n),r.SettingsController=EPUBJS.reader.SettingsController.call(r,n),r.ControlsController=EPUBJS.reader.ControlsController.call(r,n),r.SidebarController=EPUBJS.reader.SidebarController.call(r,n),r.BookmarksController=EPUBJS.reader.BookmarksController.call(r,n),r.NotesController=EPUBJS.reader.NotesController.call(r,n),window.addEventListener("hashchange",this.hashChanged.bind(this),!1),document.addEventListener("keydown",this.adjustFontSize.bind(this),!1),this.rendition.on("keydown",this.adjustFontSize.bind(this)),this.rendition.on("keydown",r.ReaderController.arrowKeys.bind(this)),this.rendition.on("selected",this.selectedRange.bind(this))}.bind(this)).then(function(){r.ReaderController.hideLoader()}.bind(this)),EPUBJS.reader.plugins)EPUBJS.reader.plugins.hasOwnProperty(o)&&(r[o]=EPUBJS.reader.plugins[o].call(r,n));return n.loaded.metadata.then(function(e){r.MetaController=EPUBJS.reader.MetaController.call(r,e)}),n.loaded.navigation.then(function(e){r.TocController=EPUBJS.reader.TocController.call(r,e)}),window.addEventListener("beforeunload",this.unload.bind(this),!1),this},EPUBJS.Reader.prototype.adjustFontSize=function(e){var t,n=e.ctrlKey||e.metaKey;this.settings.styles&&(this.settings.styles.fontSize||(this.settings.styles.fontSize="100%"),t=parseInt(this.settings.styles.fontSize.slice(0,-1)),n&&187==e.keyCode&&(e.preventDefault(),this.book.setStyle("fontSize",t+2+"%")),n&&189==e.keyCode&&(e.preventDefault(),this.book.setStyle("fontSize",t-2+"%")),n&&48==e.keyCode&&(e.preventDefault(),this.book.setStyle("fontSize","100%")))},EPUBJS.Reader.prototype.addBookmark=function(e){-1<this.isBookmarked(e)||(this.settings.bookmarks.push(e),this.trigger("reader:bookmarked",e))},EPUBJS.Reader.prototype.removeBookmark=function(e){e=this.isBookmarked(e);-1!==e&&(this.settings.bookmarks.splice(e,1),this.trigger("reader:unbookmarked",e))},EPUBJS.Reader.prototype.isBookmarked=function(e){return this.settings.bookmarks.indexOf(e)},EPUBJS.Reader.prototype.clearBookmarks=function(){this.settings.bookmarks=[]},EPUBJS.Reader.prototype.addNote=function(e){this.settings.annotations.push(e)},EPUBJS.Reader.prototype.removeNote=function(e){e=this.settings.annotations.indexOf(e);-1!==e&&delete this.settings.annotations[e]},EPUBJS.Reader.prototype.clearNotes=function(){this.settings.annotations=[]},EPUBJS.Reader.prototype.setBookKey=function(e){return this.settings.bookKey||(this.settings.bookKey="epubjsreader:"+EPUBJS.VERSION+":"+window.location.host+":"+e),this.settings.bookKey},EPUBJS.Reader.prototype.isSaved=function(e){return!!localStorage&&null!==localStorage.getItem(this.settings.bookKey)},EPUBJS.Reader.prototype.removeSavedSettings=function(){if(!localStorage)return!1;localStorage.removeItem(this.settings.bookKey)},EPUBJS.Reader.prototype.applySavedSettings=function(){var e;if(!localStorage)return!1;try{e=JSON.parse(localStorage.getItem(this.settings.bookKey))}catch(e){return!1}return!!e&&(e.styles&&(this.settings.styles=EPUBJS.core.defaults(this.settings.styles||{},e.styles)),this.settings=EPUBJS.core.defaults(this.settings,e),!0)},EPUBJS.Reader.prototype.saveSettings=function(){if(this.book&&(this.settings.previousLocationCfi=this.rendition.currentLocation().start.cfi),!localStorage)return!1;localStorage.setItem(this.settings.bookKey,JSON.stringify(this.settings))},EPUBJS.Reader.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveSettings()},EPUBJS.Reader.prototype.hashChanged=function(){var e=window.location.hash.slice(1);this.rendition.display(e)},EPUBJS.Reader.prototype.selectedRange=function(e){var t="#"+e;this.settings.history&&window.location.hash!=t&&(history.pushState({},"",t),this.currentLocationCfi=e)},RSVP.EventTarget.mixin(EPUBJS.Reader.prototype),(EPUBJS=EPUBJS||{}).storage=function(){var n=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;if(void 0===n)return console.warn("Storage: IndexedDB not available."),{init:function(){},get:function(){},set:function(){},clear:function(){}};var o;return{init:function(t){var e=n.open("epubjs-reader",1);e.onupgradeneeded=function(e){e=e.target.result;!1===e.objectStoreNames.contains("entries")&&e.createObjectStore("entries")},e.onsuccess=function(e){(o=e.target.result).onerror=function(e){console.error("IndexedDB",e)},t()},e.onerror=function(e){console.error("IndexedDB",e)}},get:function(t){o.transaction(["entries"],"readwrite").objectStore("entries").get(0).onsuccess=function(e){t(e.target.result)}},set:function(e){o.transaction(["entries"],"readwrite").objectStore("entries").put(e,0).onsuccess=function(){console.log("storage.set")}},clear:function(){void 0!==o&&(o.transaction(["entries"],"readwrite").objectStore("entries").clear().onsuccess=function(){console.log("storage.clear")})}}},EPUBJS.reader.BookmarksController=function(){function t(e){var t=document.createElement("li"),n=document.createElement("a");t.id="bookmark-"+s,t.classList.add("list_item");var o=r.spine.get(e);return o.index in r.navigation.toc?(o=r.navigation.toc[o.index],n.textContent=o.label):n.textContent=e,n.href=e,n.classList.add("bookmark_link"),n.addEventListener("click",function(e){var t=this.getAttribute("href");i.display(t),e.preventDefault()},!1),t.appendChild(n),s++,t}var r=this.book,i=this.rendition,e=$("#bookmarksView"),n=e.find("#bookmarks"),o=document.createDocumentFragment(),s=0;return this.settings.bookmarks.forEach(function(e){e=t(e);o.appendChild(e)}),n.append(o),this.on("reader:bookmarked",function(e){e=t(e);n.append(e)}),this.on("reader:unbookmarked",function(e){$("#bookmark-"+e).remove()}),{show:function(){e.show()},hide:function(){e.hide()}}},EPUBJS.reader.ControlsController=function(e){var n=this,t=this.rendition,o=($("#store"),$("#fullscreen")),r=($("#fullscreenicon"),$("#cancelfullscreenicon"),$("#slider")),i=($("#main"),$("#sidebar"),$("#settings")),s=$("#bookmark");return r.on("click",function(){n.sidebarOpen?(n.SidebarController.hide(),r.addClass("icon-menu"),r.removeClass("icon-right")):(n.SidebarController.show(),r.addClass("icon-right"),r.removeClass("icon-menu"))}),"undefined"!=typeof screenfull&&(o.on("click",function(){screenfull.toggle($("#container")[0])}),screenfull.raw&&document.addEventListener(screenfull.raw.fullscreenchange,function(){fullscreen=screenfull.isFullscreen,fullscreen?o.addClass("icon-resize-small").removeClass("icon-resize-full"):o.addClass("icon-resize-full").removeClass("icon-resize-small")})),i.on("click",function(){n.SettingsController.show()}),s.on("click",function(){var e=n.rendition.currentLocation().start.cfi;-1===n.isBookmarked(e)?(n.addBookmark(e),s.addClass("icon-bookmark").removeClass("icon-bookmark-empty")):(n.removeBookmark(e),s.removeClass("icon-bookmark").addClass("icon-bookmark-empty"))}),t.on("relocated",function(e){var t=e.start.cfi,e="#"+t;-1===n.isBookmarked(t)?s.removeClass("icon-bookmark").addClass("icon-bookmark-empty"):s.addClass("icon-bookmark").removeClass("icon-bookmark-empty"),n.currentLocationCfi=t,n.settings.history&&window.location.hash!=e&&history.pushState({},"",e)}),{}},EPUBJS.reader.MetaController=function(e){var t=e.title,n=e.creator,o=$("#book-title"),r=$("#chapter-title"),e=$("#title-seperator");document.title=t+" â€“ "+n,o.html(t),r.html(n),e.show()},EPUBJS.reader.NotesController=function(){function e(){t.show()}var s=this.book,h=this.rendition,f=this,t=$("#notesView"),o=$("#notes"),a=$("#note-text"),c=$("#note-anchor"),r=f.settings.annotations,p=s.renderer,m=[],d=new ePub.CFI,l=function(e){var t,n,o,r=s.renderer.doc;if(r.caretPositionFromPoint?(n=(t=r.caretPositionFromPoint(e.clientX,e.clientY)).offsetNode,o=t.offset):r.caretRangeFromPoint&&(n=(t=r.caretRangeFromPoint(e.clientX,e.clientY)).startContainer,o=t.startOffset),3!==n.nodeType)for(var i=0;i<n.childNodes.length;i++)if(3==n.childNodes[i].nodeType){n=n.childNodes[i];break}-1===(o=n.textContent.indexOf(".",o))?o=n.length:o+=1,o=d.generateCfiFromTextNode(n,o,s.renderer.currentChapter.cfiBase),o={annotatedAt:new Date,anchor:o,body:a.val()},f.addNote(o),u(o),g(o),a.val(""),c.text("Attach"),a.prop("disabled",!1),h.off("click",l)},u=function(e){var t=document.createElement("li"),n=document.createElement("a");t.innerHTML=e.body,n.innerHTML=" context &#187;",n.href="#"+e.anchor,n.onclick=function(){return h.display(e.anchor),!1},t.appendChild(n),o.append(t)},g=function(e){var t=s.renderer.doc,n=document.createElement("span"),o=document.createElement("a");n.classList.add("footnotesuperscript","reader_generated"),n.style.verticalAlign="super",n.style.fontSize=".75em",n.style.lineHeight="1em",o.style.padding="2px",o.style.backgroundColor="#fffa96",o.style.borderRadius="5px",o.style.cursor="pointer",n.id="note-"+EPUBJS.core.uuid(),o.innerHTML=r.indexOf(e)+1+"[Reader]",n.appendChild(o),d.addMarker(e.anchor,t,n),i(n,e.body)},i=function(s,a){var c=s.id,d=function(){m[c].classList.add("on")},l=function(){m[c].classList.remove("on")},u=function(){setTimeout(function(){m[c].classList.remove("show")},100)};s.addEventListener("mouseover",function(){var e,t,n,o,r=p.height,i=p.width;m[c]||(m[c]=document.createElement("div"),m[c].setAttribute("class","popup"),pop_content=document.createElement("div"),m[c].appendChild(pop_content),pop_content.innerHTML=a,pop_content.setAttribute("class","pop_content"),p.render.document.body.appendChild(m[c]),m[c].addEventListener("mouseover",d,!1),m[c].addEventListener("mouseout",l,!1),h.on("locationChanged",u,this),h.on("locationChanged",l,this)),e=m[c],n=(o=s.getBoundingClientRect()).left,o=o.top,e.classList.add("show"),popRect=e.getBoundingClientRect(),e.style.left=n-popRect.width/2+"px",e.style.top=o+"px",r/2.5<225&&(t=r/2.5,pop_content.style.maxHeight=t+"px"),popRect.height+o>=r-25?(e.style.top=o-popRect.height+"px",e.classList.add("above")):e.classList.remove("above"),n-popRect.width<=0?(e.style.left=n+"px",e.classList.add("left")):e.classList.remove("left"),n+popRect.width/2>=i?(e.style.left=n-300+"px",popRect=e.getBoundingClientRect(),e.style.left=n-popRect.width+"px",popRect.height+o>=r-25?(e.style.top=o-popRect.height+"px",e.classList.add("above")):e.classList.remove("above"),e.classList.add("right")):e.classList.remove("right")},!1),s.addEventListener("mouseout",u,!1),s.addEventListener("click",function(){f.ReaderController.slideOut(),e()},!1)};return c.on("click",function(e){c.text("Cancel"),a.prop("disabled","true"),h.on("click",l)}),r.forEach(function(e){u(e)}),{show:e,hide:function(){t.hide()}}},EPUBJS.reader.ReaderController=function(t){function n(){r.addClass("show")}function e(e){37==e.keyCode&&("rtl"===t.package.metadata.direction?d.next():d.prev(),a.addClass("active"),setTimeout(function(){a.removeClass("active")},100),e.preventDefault()),39==e.keyCode&&("rtl"===t.package.metadata.direction?d.prev():d.next(),s.addClass("active"),setTimeout(function(){s.removeClass("active")},100),e.preventDefault())}var o=$("#main"),r=$("#divider"),i=$("#loader"),s=$("#next"),a=$("#prev"),c=this,t=this.book,d=this.rendition,l=function(){r.removeClass("show")};return document.addEventListener("keydown",e,!1),s.on("click",function(e){"rtl"===t.package.metadata.direction?d.prev():d.next(),e.preventDefault()}),a.on("click",function(e){"rtl"===t.package.metadata.direction?d.next():d.prev(),e.preventDefault()}),d.on("layout",function(e){(!0===e.spread?n:l)()}),d.on("relocated",function(e){e.atStart&&a.addClass("disabled"),e.atEnd&&s.addClass("disabled")}),{slideOut:function(){c.settings.sidebarReflow?(o.addClass("single"),o.one("transitionend",function(){d.resize()})):o.addClass("closed")},slideIn:function(){c.settings.sidebarReflow?(o.removeClass("single"),o.one("transitionend",function(){d.resize()})):o.removeClass("closed")},showLoader:function(){i.show(),l()},hideLoader:function(){i.hide()},showDivider:n,hideDivider:l,arrowKeys:e}},EPUBJS.reader.SettingsController=function(){this.book;function e(){n.removeClass("md-show")}var t=this,n=$("#settings-modal"),o=$(".overlay");return $("#sidebarReflow").on("click",function(){t.settings.sidebarReflow=!t.settings.sidebarReflow}),n.find(".closer").on("click",function(){e()}),o.on("click",function(){e()}),{show:function(){n.addClass("md-show")},hide:e}},EPUBJS.reader.SidebarController=function(e){function n(e){var t=e+"Controller";i!=e&&void 0!==o[t]&&(o[i+"Controller"].hide(),o[t].show(),i=e,r.find(".active").removeClass("active"),r.find("#show-"+e).addClass("active"))}var o=this,t=$("#sidebar"),r=$("#panels"),i="Toc";return r.find(".show_view").on("click",function(e){var t=$(this).data("view");n(t),e.preventDefault()}),{show:function(){o.sidebarOpen=!0,o.ReaderController.slideOut(),t.addClass("open")},hide:function(){o.sidebarOpen=!1,o.ReaderController.slideIn(),t.removeClass("open")},getActivePanel:function(){return i},changePanelTo:n}},EPUBJS.reader.TocController=function(e){this.book;var n=this.rendition,o=$("#tocView").empty(),t=document.createDocumentFragment(),i=function(e,o){var r=document.createElement("ul");return o=o||1,e.forEach(function(e){var t=document.createElement("li"),n=document.createElement("a");toggle=document.createElement("a"),t.id="toc-"+e.id,t.classList.add("list_item"),n.textContent=e.label,n.href=e.href,n.classList.add("toc_link"),t.appendChild(n),e.subitems&&0<e.subitems.length&&(o++,e=i(e.subitems,o),toggle.classList.add("toc_toggle"),t.insertBefore(toggle,n),t.appendChild(e)),r.appendChild(t)}),r};n.on("renderered",function(e){var t=e.id,e=o.find("#toc-"+t),t=o.find(".currentChapter");o.find(".openChapter");e.length&&(e!=t&&0<e.has(!1).length&&t.removeClass("currentChapter"),e.addClass("currentChapter"),e.parents("li").addClass("openChapter"))});e=i(e);return t.appendChild(e),o.append(t),o.find(".toc_link").on("click",function(e){var t=this.getAttribute("href");e.preventDefault(),n.display(t),o.find(".currentChapter").addClass("openChapter").removeClass("currentChapter"),$(this).parent("li").addClass("currentChapter")}),o.find(".toc_toggle").on("click",function(e){var t=$(this).parent("li"),n=t.hasClass("openChapter");e.preventDefault(),n?t.removeClass("openChapter"):t.addClass("openChapter")}),{show:function(){o.show()},hide:function(){o.hide()}}};